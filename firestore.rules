rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection - private data owned by authenticated user
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Vendors collection - private data owned by authenticated vendor
    match /vendors/{vendorId} {
      allow read: if request.auth != null && request.auth.uid == vendorId;
      allow write: if request.auth != null && request.auth.uid == vendorId;
    }
    
    // Products collection - vendor-owned, but publicly readable
    match /products/{productId} {
      allow read: if true; // Public reading for customer apps
      allow write: if request.auth != null && 
                   request.auth.uid == resource.data.vendorId;
    }
    
    // Global orders collection
    match /orders/{orderId} {
      allow read: if request.auth != null && 
                  (request.auth.uid == resource.data.vendorId || 
                   request.auth.uid == resource.data.customerId);
      allow write: if request.auth != null && 
                   request.auth.uid == resource.data.vendorId;
    }
    
    // Customer profiles - private data owned by authenticated customer
    match /customers/{customerId} {
      allow read, write: if request.auth != null && request.auth.uid == customerId;
    }
    
    // Wallet collection - vendor-owned private data
    match /wallet/{walletId} {
      allow read, write: if request.auth != null && 
                         request.auth.uid == resource.data.ownerId;
    }
    
    // Wallet transactions - vendor-owned private data
    match /walletTransactions/{transactionId} {
      allow read, write: if request.auth != null && 
                         request.auth.uid == resource.data.ownerId;
    }
    
    // Consultation requests - accessible by vendor and customer
    match /consultation_requests/{requestId} {
      allow read: if request.auth != null && 
                  (request.auth.uid == resource.data.vendorId || 
                   request.auth.uid == resource.data.customerId);
      allow write: if request.auth != null && 
                   (request.auth.uid == resource.data.vendorId || 
                    request.auth.uid == resource.data.customerId);
    }
    
    // Admin notifications - admin access only (for now allow vendor access to their notifications)
    match /admin_notifications/{notificationId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null;
    }
    
    // Analytics and statistics - vendor-owned
    match /analytics/{vendorId} {
      allow read, write: if request.auth != null && request.auth.uid == vendorId;
    }
  }
}